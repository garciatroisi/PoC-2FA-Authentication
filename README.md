# 2FA Authentication with NestJS

## Description

This project implements a two-factor authentication (2FA) system using **TOTP (Time-Based One-Time Password)**. It is built with **NestJS** and allows users to generate QR codes for 2FA setup and verify authentication tokens generated by apps like Google Authenticator or Authy.

### Features:

- **Secret key generation**: Generates TOTP secret keys for each user.
- **QR code generation**: Returns a QR code that users can scan with their authentication app.
- **Token verification**: Verifies tokens generated by the user through their authentication app.

## Requirements

- **Node.js**: Version 14 or higher
- **Yarn**: Dependency manager

## Installation

1. Clone the repository

2. Install dependencies with **Yarn**:
   ```bash
   yarn install
   ```

### Running the Project

To run the development server, execute the following command:

```bash
yarn start
```

The server will be running at `http://localhost:3000`.

### Testing

This project includes unit tests and end-to-end (E2E) tests using **Jest**.

- **Unit tests**: Run them with the following command:

  ```bash
  yarn test
  ```

- **End-to-End (E2E) tests**: Run them with the following command:
  ```bash
  yarn test:e2e
  ```

### Postman Collection

This project includes a Postman collection to test the available endpoints.

1. Open Postman.
2. Import the collection from the `postman_collection.json` file located in the root directory of the project.
3. Run the tests for the endpoints to generate the QR code and verify the tokens.

## Endpoints

### 1. **Generate Secret Key and QR Code**

- **Method**: `GET`
- **Route**: `/auth/generate/:userId`
- **Description**: Generates a secret key for the user with `userId` and returns a QR code to set up 2FA in the authentication app.

### 2. **Verify 2FA Token**

- **Method**: `POST`
- **Route**: `/auth/verify/:userId`
- **Description**: Verifies if the provided authentication token is valid for the user with `userId`.
- **Parameters**:
  - `userId`: The user's ID.
  - `token`: The token generated by the authentication app.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
